<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Signature du contrat</title>
    <style>
        /* Styles pour le visualiseur PDF et la zone de signature */
        #pdf-viewer {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
        }

        #signature-pad {
            border: 1px solid #ccc;
            width: 100%;
            max-width: 500px;
            height: 200px;
            margin-top: 20px;
        }

        #buttons {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1>Signature du contrat</h1>
    <iframe id="pdf-viewer" src="{{ contract_url }}"></iframe>

    <h2>Veuillez signer ci-dessous :</h2>
    <canvas id="signature-pad"></canvas>
    <div id="buttons">
        <button id="clear">Effacer</button>
        <button id="save">Signer le contrat</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
    <script>
        var canvas = document.getElementById('signature-pad');
        var signaturePad = new SignaturePad(canvas);

        document.getElementById('clear').addEventListener('click', function () {
            signaturePad.clear();
        });

        document.getElementById('save').addEventListener('click', function () {
            if (signaturePad.isEmpty()) {
                alert('Veuillez fournir une signature.');
            } else {
                var dataURL = signaturePad.toDataURL();

                // Envoyer la signature au serveur
                fetch('/save_signed_contract', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        signature: dataURL,
                        artist_name: "{{ artist_name }}",
                        contract_url: "{{ contract_url }}"
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === "success") {
                            alert('Contrat signé avec succès !');
                            // Rediriger vers le contrat signé ou afficher le lien
                            window.location.href = data.signed_contract_url;
                        } else {
                            alert('Erreur : ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Erreur:', error);
                        alert('Erreur lors de la signature du contrat');
                    });
            }
        });
    </script>
</body>

</html>